{% comment %}
  Smart Breadcrumbs - Main Entry Point
  Version: 2.0.0
  
  This snippet determines the page type and includes the appropriate
  breadcrumb template.
{% endcomment %}

{% assign page_type = template.name | split: '.' | first %}

{% case page_type %}
  {% when 'product' %}
    {% render 'smart-breadcrumbs-product' %}
  
  {% when 'collection' %}
    {% render 'smart-breadcrumbs-collection' %}
  
  {% when 'cart' %}
    {% render 'smart-breadcrumbs-cart' %}
  
  {% else %}
    {% render 'smart-breadcrumbs-page' %}
{% endcase %}

{% if request.path contains '?debug=true' or request.path contains '?debug=1' or request.path contains '?debug_breadcrumbs=1' %}
  <div style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f5f5f5; font-family: monospace; font-size: 12px;">
    <h4>Master Breadcrumb Info:</h4>
    <p>Detected Template: {{ template.name }}</p>
    <p>Detected Page Type: {{ page_type }}</p>
    <p>Current URL: {{ request.path }}</p>
  </div>
{% endif %}

{% comment %}
  Smart Breadcrumbs v1.1.0
  Main breadcrumb snippet that determines which template to load based on page context
{% endcomment %}

{%- assign settings = section.settings -%}

{%- if settings.show_breadcrumbs == false -%}
  {% return %}
{%- endif -%}

{%- if template == 'index' and settings.show_on_homepage == false -%}
  {% return %}
{%- endif -%}

{%- if template contains 'collection' and settings.show_on_collections == false -%}
  {% return %}
{%- endif -%}

{%- if template contains 'product' and settings.show_on_products == false -%}
  {% return %}
{%- endif -%}

{%- if template contains 'page' and settings.show_on_pages == false -%}
  {% return %}
{%- endif -%}

{%- if template contains 'blog' or template contains 'article' and settings.show_on_blog == false -%}
  {% return %}
{%- endif -%}

{% capture breadcrumb_style %}
  .breadcrumb-container {
    padding: 10px 20px;
    margin-bottom: 20px;
    font-size: 14px;
    {% if settings.breadcrumb_style == 'default' %}
      background-color: {{ settings.breadcrumb_bg_color | default: '#f9f9f9' }};
      border-radius: 4px;
    {% elsif settings.breadcrumb_style == 'minimal' %}
      background-color: transparent;
      padding: 10px 0;
    {% elsif settings.breadcrumb_style == 'bordered' %}
      border: 1px solid #e8e8e8;
      border-radius: 4px;
      background-color: #ffffff;
    {% endif %}
  }
  .breadcrumb-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
  }
  .breadcrumb-item {
    display: inline-flex;
    align-items: center;
    color: {{ settings.breadcrumb_text_color | default: '#555555' }};
  }
  .breadcrumb-item a {
    color: inherit;
    text-decoration: none;
  }
  .breadcrumb-item a:hover {
    text-decoration: underline;
  }
  .breadcrumb-item.current {
    font-weight: bold;
    color: {{ settings.breadcrumb_current_color | default: '#333333' }};
  }
  .breadcrumb-separator {
    margin: 0 8px;
    color: {{ settings.breadcrumb_text_color | default: '#555555' }};
    opacity: 0.5;
  }
  @media screen and (max-width: 767px) {
    .breadcrumb-container {
      padding: 8px 15px;
      margin-bottom: 15px;
      font-size: 12px;
    }
    .breadcrumb-separator {
      margin: 0 5px;
    }
  }
{% endcapture %}

{%- assign separator = '/' -%}
{%- if settings.breadcrumb_separator == 'arrow' -%}
  {%- assign separator = '›' -%}
{%- elsif settings.breadcrumb_separator == 'bullet' -%}
  {%- assign separator = '•' -%}
{%- endif -%}

<style>
  {{ breadcrumb_style }}
</style>

{%- if template contains 'product' -%}
  {%- render 'smart-breadcrumbs-product', separator: separator -%}
{%- elsif template contains 'collection' -%}
  {%- render 'smart-breadcrumbs-collection', separator: separator -%}
{%- else -%}
  {%- render 'smart-breadcrumbs-page', separator: separator -%}
{%- endif -%}

{% comment %}
  Smart Breadcrumbs
  Simple breadcrumb navigation for Shopify
  v1.0.0
{% endcomment %}

{% assign home_text = settings.home_text | default: 'Home' %}
{% assign separator = settings.separator | default: '/' %}
{% assign text_color = settings.text_color | default: '#555555' %}
{% assign current_color = settings.current_color | default: '#333333' %}
{% assign background_color = settings.background_color | default: 'rgba(240, 240, 240, 0.5)' %}

<style>
  .smart-breadcrumbs {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    font-size: 14px;
    line-height: 1.4;
    margin: 12px 0;
    padding: 8px 12px;
    border-radius: 4px;
    background-color: {{ background_color }};
  }
  
  .smart-breadcrumbs ol {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .smart-breadcrumbs li {
    display: inline-flex;
    align-items: center;
  }
  
  .smart-breadcrumbs a {
    color: {{ text_color }};
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  .smart-breadcrumbs a:hover {
    color: #000;
    text-decoration: underline;
  }
  
  .smart-breadcrumbs .separator {
    margin: 0 8px;
    color: {{ text_color }};
    opacity: 0.6;
  }
  
  .smart-breadcrumbs .current {
    font-weight: 500;
    color: {{ current_color }};
  }
  
  @media (max-width: 480px) {
    .smart-breadcrumbs {
      font-size: 12px;
      padding: 6px 10px;
    }
    
    .smart-breadcrumbs .separator {
      margin: 0 6px;
    }
  }
</style>

<nav class="smart-breadcrumbs" aria-label="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    <!-- Home -->
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a href="/" itemprop="item">
        <span itemprop="name">{{ home_text }}</span>
      </a>
      <meta itemprop="position" content="1" />
    </li>
    
    <li class="separator" aria-hidden="true">{{ separator }}</li>
    
    {% if template contains 'product' %}
      {% if collection and collection.handle != 'all' %}
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="{{ collection.url }}" itemprop="item">
            <span itemprop="name">{{ collection.title }}</span>
          </a>
          <meta itemprop="position" content="2" />
        </li>
        <li class="separator" aria-hidden="true">{{ separator }}</li>
      {% elsif product.collections.size > 0 %}
        {% assign collection = product.collections.first %}
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="{{ collection.url }}" itemprop="item">
            <span itemprop="name">{{ collection.title }}</span>
          </a>
          <meta itemprop="position" content="2" />
        </li>
        <li class="separator" aria-hidden="true">{{ separator }}</li>
      {% endif %}
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">{{ product.title }}</span>
        <meta itemprop="item" content="{{ shop.url }}{{ product.url }}" />
        <meta itemprop="position" content="{% if collection %}3{% else %}2{% endif %}" />
      </li>
    
    {% elsif template contains 'collection' %}
      {% if collection.handle != 'all' %}
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <span class="current" itemprop="name">{{ collection.title }}</span>
          <meta itemprop="item" content="{{ shop.url }}{{ collection.url }}" />
          <meta itemprop="position" content="2" />
        </li>
      {% else %}
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <span class="current" itemprop="name">All Products</span>
          <meta itemprop="item" content="{{ shop.url }}/collections/all" />
          <meta itemprop="position" content="2" />
        </li>
      {% endif %}
      
    {% elsif template contains 'blog' %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">{{ blog.title }}</span>
        <meta itemprop="item" content="{{ shop.url }}{{ blog.url }}" />
        <meta itemprop="position" content="2" />
      </li>
      
    {% elsif template contains 'article' %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href="{{ blog.url }}" itemprop="item">
          <span itemprop="name">{{ blog.title }}</span>
        </a>
        <meta itemprop="position" content="2" />
      </li>
      <li class="separator" aria-hidden="true">{{ separator }}</li>
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">{{ article.title }}</span>
        <meta itemprop="item" content="{{ shop.url }}{{ article.url }}" />
        <meta itemprop="position" content="3" />
      </li>
      
    {% elsif template contains 'page' %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">{{ page.title }}</span>
        <meta itemprop="item" content="{{ shop.url }}{{ page.url }}" />
        <meta itemprop="position" content="2" />
      </li>
      
    {% elsif template contains 'cart' %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">Shopping Cart</span>
        <meta itemprop="item" content="{{ shop.url }}/cart" />
        <meta itemprop="position" content="2" />
      </li>
      
    {% elsif template contains 'search' %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">Search Results</span>
        <meta itemprop="item" content="{{ shop.url }}/search" />
        <meta itemprop="position" content="2" />
      </li>
      
    {% elsif template == '404' %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">Page Not Found</span>
        <meta itemprop="item" content="{{ shop.url }}/404" />
        <meta itemprop="position" content="2" />
      </li>
      
    {% else %}
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="current" itemprop="name">{{ page_title }}</span>
        <meta itemprop="item" content="{{ shop.url }}{{ request.path }}" />
        <meta itemprop="position" content="2" />
      </li>
    {% endif %}
  </ol>
</nav>

{% comment %}
  Add Schema.org JSON-LD for SEO
{% endcomment %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "{{ home_text }}",
      "item": "{{ shop.url }}"
    }
    {% if template contains 'product' %}
      {% if collection and collection.handle != 'all' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | json }},
        "item": "{{ shop.url }}{{ collection.url }}"
      }
      {% elsif product.collections.size > 0 %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ product.collections.first.title | json }},
        "item": "{{ shop.url }}{{ product.collections.first.url }}"
      }
      {% endif %}
      ,{
        "@type": "ListItem",
        "position": {% if collection or product.collections.size > 0 %}3{% else %}2{% endif %},
        "name": {{ product.title | json }},
        "item": "{{ shop.url }}{{ product.url }}"
      }
    {% elsif template contains 'collection' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {% if collection.handle != 'all' %}{{ collection.title | json }}{% else %}"All Products"{% endif %},
        "item": "{{ shop.url }}{{ collection.url }}"
      }
    {% elsif template contains 'blog' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ blog.title | json }},
        "item": "{{ shop.url }}{{ blog.url }}"
      }
    {% elsif template contains 'article' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ blog.title | json }},
        "item": "{{ shop.url }}{{ blog.url }}"
      }
      ,{
        "@type": "ListItem",
        "position": 3,
        "name": {{ article.title | json }},
        "item": "{{ shop.url }}{{ article.url }}"
      }
    {% elsif template contains 'page' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ page.title | json }},
        "item": "{{ shop.url }}{{ page.url }}"
      }
    {% elsif template contains 'cart' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": "Shopping Cart",
        "item": "{{ shop.url }}/cart"
      }
    {% elsif template contains 'search' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": "Search Results",
        "item": "{{ shop.url }}/search"
      }
    {% elsif template == '404' %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": "Page Not Found",
        "item": "{{ shop.url }}/404"
      }
    {% else %}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ page_title | json }},
        "item": "{{ shop.url }}{{ request.path }}"
      }
    {% endif %}
  ]
}
</script>

{% if request.path contains '?debug=true' %}
  <div style="background: #f8f8f8; border: 1px solid #ddd; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px;">
    <strong>Debug Info:</strong><br>
    Template: {{ template }}<br>
    Path: {{ request.path }}<br>
    {% if template contains 'product' %}
      Product: {{ product.title }}<br>
      Collection: {% if collection %}{{ collection.title }}{% elsif product.collections.size > 0 %}{{ product.collections.first.title }}{% else %}None{% endif %}<br>
    {% elsif template contains 'collection' %}
      Collection: {{ collection.title }}<br>
      Handle: {{ collection.handle }}<br>
    {% endif %}
  </div>
{% endif %} 