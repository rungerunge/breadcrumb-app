{% comment %}
    Smart Breadcrumbs - Main Snippet
    Version: 2.1.4
    
    This snippet generates breadcrumbs based on your Shopify navigation menus
    and handles product pages with proper collection context.
{% endcomment %}

{%- style -%}
.smart-breadcrumbs {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    padding: {{ settings.marginTop | default: 20 }}px 0 {{ settings.marginBottom | default: 20 }}px;
    margin: 0;
    list-style: none;
    font-size: {{ settings.fontSize | default: 14 }}px;
}

.smart-breadcrumbs__list {
    display: flex;
    flex-wrap: wrap;
    padding: 0;
    margin: 0;
    list-style: none;
    width: 100%;
}

.smart-breadcrumbs__item {
    display: flex;
    align-items: center;
    white-space: nowrap;
}

.smart-breadcrumbs__link {
    color: var(--breadcrumb-color, #666);
    text-decoration: none;
    transition: color 0.2s ease;
}

.smart-breadcrumbs__link:hover {
    color: var(--breadcrumb-hover-color, #000);
}

.smart-breadcrumbs__separator {
    margin: 0 8px;
    color: var(--breadcrumb-separator-color, #999);
}

.smart-breadcrumbs__current {
    color: var(--breadcrumb-current-color, #333);
    font-weight: 500;
}

{% if settings.customCssAll != blank %}
{{ settings.customCssAll }}
{% endif %}

{% if settings.customCssLast != blank %}
.smart-breadcrumbs__item:last-child {
    {{ settings.customCssLast }}
}
{% endif %}

{% if settings.customCssHover != blank %}
.smart-breadcrumbs__link:hover {
    {{ settings.customCssHover }}
}
{% endif %}

@media screen and (min-width: 769px) {
    {% if settings.customCssDesktop != blank %}
    {{ settings.customCssDesktop }}
    {% endif %}
}

@media screen and (max-width: 768px) {
    .smart-breadcrumbs {
        font-size: {{ settings.fontSize | minus: 2 | default: 12 }}px;
        padding: 10px 0;
    }
    
    .smart-breadcrumbs__separator {
        margin: 0 4px;
    }
    
    {% if settings.customCssMobile != blank %}
    {{ settings.customCssMobile }}
    {% endif %}
}
{%- endstyle -%}

<nav class="smart-breadcrumbs" aria-label="breadcrumb">
  <ol class="smart-breadcrumbs__list">
    {% comment %}Always show Home link{% endcomment %}
    <li class="smart-breadcrumbs__item">
      <a href="/" class="smart-breadcrumbs__link">Home</a>
      <span class="smart-breadcrumbs__separator" aria-hidden="true">{{ settings.separator | default: '/' }}</span>
    </li>

    {% if template contains 'product' %}
      {% comment %}Handle product pages with collection context{% endcomment %}
      {% if collection %}
        <li class="smart-breadcrumbs__item">
          <a href="{{ collection.url }}" class="smart-breadcrumbs__link">{{ collection.title }}</a>
          <span class="smart-breadcrumbs__separator" aria-hidden="true">{{ settings.separator | default: '/' }}</span>
        </li>
      {% elsif product.collections.size > 0 %}
        {% assign primary_collection = product.collections.first %}
        <li class="smart-breadcrumbs__item">
          <a href="{{ primary_collection.url }}" class="smart-breadcrumbs__link">{{ primary_collection.title }}</a>
          <span class="smart-breadcrumbs__separator" aria-hidden="true">{{ settings.separator | default: '/' }}</span>
        </li>
      {% endif %}
      <li class="smart-breadcrumbs__item">
        <span class="smart-breadcrumbs__current" aria-current="page">{{ product.title }}</span>
      </li>

    {% elsif template contains 'collection' %}
      {% comment %}Handle collection pages{% endcomment %}
      <li class="smart-breadcrumbs__item">
        {% if current_tags %}
          <a href="{{ collection.url }}" class="smart-breadcrumbs__link">{{ collection.title }}</a>
          <span class="smart-breadcrumbs__separator" aria-hidden="true">{{ settings.separator | default: '/' }}</span>
          <span class="smart-breadcrumbs__current" aria-current="page">{{ current_tags | join: " + " }}</span>
        {% else %}
          <span class="smart-breadcrumbs__current" aria-current="page">{{ collection.title }}</span>
        {% endif %}
      </li>

    {% elsif template contains 'page' %}
      {% comment %}Handle regular pages{% endcomment %}
      <li class="smart-breadcrumbs__item">
        <span class="smart-breadcrumbs__current" aria-current="page">{{ page.title }}</span>
      </li>

    {% elsif template contains 'blog' %}
      {% comment %}Handle blog pages{% endcomment %}
      <li class="smart-breadcrumbs__item">
        {% if current_tags %}
          <a href="{{ blog.url }}" class="smart-breadcrumbs__link">{{ blog.title }}</a>
          <span class="smart-breadcrumbs__separator" aria-hidden="true">{{ settings.separator | default: '/' }}</span>
          <span class="smart-breadcrumbs__current" aria-current="page">{{ current_tags | join: " + " }}</span>
        {% else %}
          <span class="smart-breadcrumbs__current" aria-current="page">{{ blog.title }}</span>
        {% endif %}
      </li>

    {% elsif template contains 'article' %}
      {% comment %}Handle blog articles{% endcomment %}
      <li class="smart-breadcrumbs__item">
        <a href="{{ blog.url }}" class="smart-breadcrumbs__link">{{ blog.title }}</a>
        <span class="smart-breadcrumbs__separator" aria-hidden="true">{{ settings.separator | default: '/' }}</span>
      </li>
      <li class="smart-breadcrumbs__item">
        <span class="smart-breadcrumbs__current" aria-current="page">{{ article.title }}</span>
      </li>

    {% else %}
      {% comment %}Handle any other pages{% endcomment %}
      <li class="smart-breadcrumbs__item">
        <span class="smart-breadcrumbs__current" aria-current="page">{{ page_title }}</span>
      </li>
    {% endif %}
  </ol>
</nav>

{% comment %}Debug information (hidden in production){% endcomment %}
{% if settings.debug_mode %}
  <div style="display: none;">
    <p>Debug Information:</p>
    <p>Template: {{ template }}</p>
    <p>Collection: {{ collection.title }}</p>
    <p>Product Collections: {{ product.collections | map: 'title' | join: ', ' }}</p>
    <p>Current Tags: {{ current_tags | join: ', ' }}</p>
  </div>
{% endif %} 