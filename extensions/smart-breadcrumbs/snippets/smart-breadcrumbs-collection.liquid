{% comment %}
    Smart Breadcrumbs - Collection Template
    Version: 2.0.0
    
    This snippet generates breadcrumbs for collection pages with improved error handling
    and mobile responsiveness.
{% endcomment %}

{%- style -%}
.smart-breadcrumbs {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    padding: 10px 0;
    margin: 0;
    font-size: var(--breadcrumb-font-size, 14px);
    background-color: rgba(0, 0, 0, 0.03);
    padding: 8px 15px;
    border-radius: 4px;
}

.smart-breadcrumbs__link {
    color: var(--breadcrumb-color, #666);
    text-decoration: none;
    transition: color 0.2s ease;
}

.smart-breadcrumbs__link:hover {
    color: var(--breadcrumb-hover-color, #000);
}

.smart-breadcrumbs__separator {
    margin: 0 8px;
    color: var(--breadcrumb-separator-color, #999);
}

.smart-breadcrumbs__current {
    color: var(--breadcrumb-current-color, #333);
    font-weight: 500;
}

@media screen and (max-width: 768px) {
    .smart-breadcrumbs {
        font-size: var(--breadcrumb-mobile-font-size, 12px);
        padding: 8px 12px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    
    .smart-breadcrumbs::-webkit-scrollbar {
        display: none;
    }
    
    .smart-breadcrumbs__separator {
        margin: 0 4px;
    }
}
{%- endstyle -%}

<nav class="smart-breadcrumbs" aria-label="breadcrumb">
    <!-- Home Link -->
    <a href="/" class="smart-breadcrumbs__link">Home</a>
    
    {% if collection %}
    <!-- Current Collection -->
    <span class="smart-breadcrumbs__separator">/</span>
    <span class="smart-breadcrumbs__current">{{ collection.title }}</span>
    {% endif %}
</nav>

{% comment %} Error Handling {% endcomment %}
{% unless collection %}
    {% capture debug_info %}
      Collection object not available
      Page type: {{ request.page_type }}
      Path: {{ request.path }}
      Template: {{ template }}
    {% endcapture %}
{% endunless %}

{% comment %}
  Smart Breadcrumbs - Collection Template
  Displays breadcrumb navigation for collection pages with parent collection support
  v5.1.0
{% endcomment %}

<style>
  .breadcrumb-container {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    font-size: 14px;
    line-height: 1.4;
    margin: 10px 0;
    padding: 8px 12px;
    background-color: rgba(240, 240, 240, 0.5);
    border-radius: 4px;
  }
  .breadcrumb-list {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    padding: 0;
    margin: 0;
    list-style: none;
  }
  .breadcrumb-item {
    display: inline-flex;
    align-items: center;
  }
  .breadcrumb-link {
    color: #555;
    text-decoration: none;
    transition: color 0.2s ease;
  }
  .breadcrumb-link:hover {
    color: #000;
    text-decoration: underline;
  }
  .breadcrumb-separator {
    margin: 0 8px;
    color: #999;
  }
  .breadcrumb-current {
    font-weight: 500;
    color: #333;
  }
  @media (max-width: 480px) {
    .breadcrumb-container {
      font-size: 12px;
      padding: 6px 10px;
    }
    .breadcrumb-separator {
      margin: 0 6px;
    }
  }
</style>

{% liquid
  # Set up schema data
  assign position = 1
  
  # Check for parent collection through metafields
  assign parent_collection_handle = collection.metafields.breadcrumbs.parent_collection
  if parent_collection_handle != blank
    assign parent_collection = collections[parent_collection_handle]
  endif
  
  # Check for grandparent collection
  assign grandparent_collection_handle = parent_collection.metafields.breadcrumbs.parent_collection
  if grandparent_collection_handle != blank
    assign grandparent_collection = collections[grandparent_collection_handle]
  endif
%}

<nav class="breadcrumb-container" aria-label="breadcrumbs">
  <ol class="breadcrumb-list" itemscope itemtype="https://schema.org/BreadcrumbList">
    <!-- Home -->
    <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a class="breadcrumb-link" href="/" itemprop="item">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content="{{ position }}" />
      {% assign position = position | plus: 1 %}
      <span class="breadcrumb-separator" aria-hidden="true">/</span>
    </li>
    
    <!-- Grandparent Collection (if available) -->
    {% if grandparent_collection %}
      <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="breadcrumb-link" href="{{ grandparent_collection.url }}" itemprop="item">
          <span itemprop="name">{{ grandparent_collection.title }}</span>
        </a>
        <meta itemprop="position" content="{{ position }}" />
        {% assign position = position | plus: 1 %}
        <span class="breadcrumb-separator" aria-hidden="true">/</span>
      </li>
    {% endif %}
    
    <!-- Parent Collection (if available) -->
    {% if parent_collection %}
      <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="breadcrumb-link" href="{{ parent_collection.url }}" itemprop="item">
          <span itemprop="name">{{ parent_collection.title }}</span>
        </a>
        <meta itemprop="position" content="{{ position }}" />
        {% assign position = position | plus: 1 %}
        <span class="breadcrumb-separator" aria-hidden="true">/</span>
      </li>
    {% endif %}
    
    <!-- Current Collection -->
    <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <span class="breadcrumb-current" itemprop="name">{{ collection.title }}</span>
      <meta itemprop="item" content="{{ shop.url }}{{ collection.url }}" />
      <meta itemprop="position" content="{{ position }}" />
    </li>
  </ol>
</nav>

<!-- Structured data for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ shop.url }}"
    }
    {% if grandparent_collection %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ grandparent_collection.title | json }},
      "item": "{{ shop.url }}{{ grandparent_collection.url }}"
    }
    {% endif %}
    {% if parent_collection %}
    ,{
      "@type": "ListItem",
      "position": {% if grandparent_collection %}3{% else %}2{% endif %},
      "name": {{ parent_collection.title | json }},
      "item": "{{ shop.url }}{{ parent_collection.url }}"
    }
    {% endif %}
    ,{
      "@type": "ListItem",
      "position": {{ position }},
      "name": {{ collection.title | json }},
      "item": "{{ shop.url }}{{ collection.url }}"
    }
  ]
}
</script>

{% comment %} Advanced debug information - only visible when ?debug=true is in URL {% endcomment %}
{% if request.design_mode or request.query_string contains 'debug=true' %}
  <div style="font-size: 12px; color: #777; background: #f7f7f7; padding: 10px; margin-top: 10px; border-radius: 4px;">
    <p style="margin: 0 0 5px 0;"><strong>Collection Breadcrumb Debug Info:</strong></p>
    <p style="margin: 0 0 5px 0;">Current Collection: {{ collection.title }} ({{ collection.handle }})</p>
    <p style="margin: 0 0 5px 0;">Collection Hierarchy:</p>
    <ul style="margin: 0; padding-left: 20px;">
      <li>Parent Collection: {% if parent_collection %}{{ parent_collection.title }} ({{ parent_collection.handle }}){% else %}None{% endif %}</li>
      <li>Grandparent Collection: {% if grandparent_collection %}{{ grandparent_collection.title }} ({{ grandparent_collection.handle }}){% else %}None{% endif %}</li>
    </ul>
    {% if collection.metafields.breadcrumbs %}
      <p style="margin: 5px 0 0 0;">Collection Metafields:</p>
      <ul style="margin: 0; padding-left: 20px;">
        <li>Parent Collection: {{ collection.metafields.breadcrumbs.parent_collection | default: 'None' }}</li>
      </ul>
    {% endif %}
  </div>
{% endif %}

{% comment %}
Smart Breadcrumbs - Collection Page Template v1.0.0
This template creates breadcrumbs specifically for collection pages with parent-child collection relationships.
{% endcomment %}

<style>
  .breadcrumb {
    padding: 8px 15px;
    margin-bottom: 20px;
    list-style: none;
    background-color: #f8f9fa;
    border-radius: 4px;
    font-size: 14px;
    display: flex;
    flex-wrap: wrap;
  }
  .breadcrumb-item {
    display: inline-block;
    margin-right: 5px;
  }
  .breadcrumb-item a {
    color: #007bff;
    text-decoration: none;
  }
  .breadcrumb-item a:hover {
    text-decoration: underline;
    color: #0056b3;
  }
  .breadcrumb-item:last-child {
    color: #6c757d;
  }
  .breadcrumb-item + .breadcrumb-item::before {
    padding-right: 5px;
    content: "/";
    color: #6c757d;
  }
  @media (max-width: 768px) {
    .breadcrumb {
      padding: 6px 10px;
      font-size: 12px;
    }
  }
</style>

{% assign parent_collection = null %}
{% if collection.metafields.custom.parent_collection %}
  {% assign parent_collection_handle = collection.metafields.custom.parent_collection %}
  {% for coll in collections %}
    {% if coll.handle == parent_collection_handle %}
      {% assign parent_collection = coll %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="/">Home</a>
    </li>
    
    {% if parent_collection %}
      <li class="breadcrumb-item">
        <a href="{{ parent_collection.url }}">{{ parent_collection.title }}</a>
      </li>
    {% endif %}
    
    <li class="breadcrumb-item" aria-current="page">
      {{ collection.title }}
    </li>
  </ol>
</nav>

{% if request.path contains '?debug=1' %}
  <div style="background: #f0f0f0; padding: 10px; margin-bottom: 20px; font-family: monospace; font-size: 12px;">
    <p>Debug Info:</p>
    <p>Collection: {{ collection.title }}</p>
    <p>Collection Handle: {{ collection.handle }}</p>
    <p>Parent Collection Handle: {{ parent_collection_handle }}</p>
    <p>Parent Collection Title: {{ parent_collection.title }}</p>
  </div>
{% endif %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ shop.url }}"
    }{% if parent_collection %},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ parent_collection.title }}",
      "item": "{{ shop.url }}{{ parent_collection.url }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ collection.title }}",
      "item": "{{ shop.url }}{{ collection.url }}"
    }
    {% else %},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ collection.title }}",
      "item": "{{ shop.url }}{{ collection.url }}"
    }
    {% endif %}
  ]
}
</script> 