{% comment %}
  Smart Breadcrumbs - Theme Block
  Easy to use breadcrumbs based on menu structure with customization options
  v1.0.0
{% endcomment %}

{% schema %}
{
  "name": "Smart Breadcrumbs",
  "target": "section",
  "stylesheet": "breadcrumbs.css",
  "javascript": "breadcrumbs.js",
  "settings": [
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "label": "Show breadcrumbs?",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "use_slider",
      "label": "Use slider for mobile",
      "info": "On mobile, long breadcrumbs become a slider, scrolling left-right instead of wrapping",
      "default": false
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "rgba(240, 240, 240, 0.5)"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Horizontal alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font size",
      "min": 10,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "text",
      "id": "font_family",
      "label": "Font family",
      "info": "Leave blank to use theme default",
      "default": ""
    },
    {
      "type": "text",
      "id": "home_text",
      "label": "Home link text",
      "default": "Home"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#555555"
    },
    {
      "type": "color",
      "id": "hover_color",
      "label": "Hover color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "separator_color",
      "label": "Separator color",
      "default": "#999999"
    },
    {
      "type": "color",
      "id": "current_color",
      "label": "Current item color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin from top",
      "info": "Top margin in pixels",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "margin_right",
      "label": "Margin from right",
      "info": "Right margin in pixels",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin from bottom",
      "info": "Bottom margin in pixels",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "margin_left",
      "label": "Margin from left",
      "info": "Left margin in pixels",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "Advanced"
    },
    {
      "type": "checkbox",
      "id": "use_uppercase",
      "label": "Use uppercase text?",
      "default": false
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Custom CSS for breadcrumbs",
      "info": "Add any custom CSS styles here"
    },
    {
      "type": "textarea",
      "id": "last_item_css",
      "label": "Custom CSS for last item",
      "info": "Add custom styles for the current/last breadcrumb item",
      "default": "font-weight: 500;"
    },
    {
      "type": "textarea",
      "id": "hover_css",
      "label": "Custom CSS for hover state",
      "info": "Add custom styles for link hover state",
      "default": "text-decoration: underline;"
    }
  ],
  "presets": [
    {
      "name": "Smart Breadcrumbs",
      "category": "Navigation"
    }
  ]
}
{% endschema %}

<div data-smart-breadcrumbs class="smart-breadcrumbs-block">
  {% comment %}
    This container will be populated by the JavaScript client
    with breadcrumbs based on the site's menu structure
  {% endcomment %}
</div>

<script>
  (function() {
    // Collect settings from block
    var settings = {
      showBreadcrumbs: {{ block.settings.show_breadcrumbs | default: true | json }},
      useSlider: {{ block.settings.use_slider | default: false | json }},
      fontFamily: {{ block.settings.font_family | json }},
      fontSize: {{ block.settings.font_size | default: 14 | json }},
      textColor: {{ block.settings.text_color | default: '#555555' | json }},
      hoverColor: {{ block.settings.hover_color | default: '#000000' | json }},
      separatorColor: {{ block.settings.separator_color | default: '#999999' | json }},
      currentColor: {{ block.settings.current_color | default: '#333333' | json }},
      backgroundColor: {{ block.settings.background_color | default: 'rgba(240, 240, 240, 0.5)' | json }},
      homeText: {{ block.settings.home_text | default: 'Home' | json }},
      alignment: {{ block.settings.alignment | default: 'left' | json }},
      marginTop: {{ block.settings.margin_top | default: 10 | json }},
      marginRight: {{ block.settings.margin_right | default: 0 | json }},
      marginBottom: {{ block.settings.margin_bottom | default: 10 | json }},
      marginLeft: {{ block.settings.margin_left | default: 0 | json }},
      useUppercase: {{ block.settings.use_uppercase | default: false | json }},
      customCSS: {{ block.settings.custom_css | default: '' | json }},
      lastItemCSS: {{ block.settings.last_item_css | default: 'font-weight: 500;' | json }},
      hoverCSS: {{ block.settings.hover_css | default: 'text-decoration: underline;' | json }}
    };
    
    // Set meta tag with settings
    var settingsTag = document.querySelector('meta[name="breadcrumb-settings"]');
    if (!settingsTag) {
      settingsTag = document.createElement('meta');
      settingsTag.name = 'breadcrumb-settings';
      document.head.appendChild(settingsTag);
    }
    settingsTag.content = encodeURIComponent(JSON.stringify(settings));
    
    // Load required scripts if not already loaded
    function loadScript(src, callback) {
      var script = document.createElement('script');
      script.src = src;
      script.onload = callback;
      document.head.appendChild(script);
    }
    
    function loadScripts() {
      if (!window.smartBreadcrumbsSettings) {
        loadScript("{{ 'breadcrumb-settings.js' | asset_url }}", function() {
          if (!window.smartBreadcrumbs) {
            loadScript("{{ 'menu-parser.js' | asset_url }}", function() {
              loadScript("{{ 'breadcrumb-client.js' | asset_url }}", function() {});
            });
          } else {
            loadScript("{{ 'breadcrumb-client.js' | asset_url }}", function() {});
          }
        });
      } else if (!window.smartBreadcrumbs) {
        loadScript("{{ 'menu-parser.js' | asset_url }}", function() {
          if (!window.smartBreadcrumbsClient) {
            loadScript("{{ 'breadcrumb-client.js' | asset_url }}", function() {});
          }
        });
      } else if (!window.smartBreadcrumbsClient) {
        loadScript("{{ 'breadcrumb-client.js' | asset_url }}", function() {});
      }
    }
    
    // Load scripts
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadScripts);
    } else {
      loadScripts();
    }
  })();
</script> 