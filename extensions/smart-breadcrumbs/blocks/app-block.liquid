{% comment %}
Smart Breadcrumbs App Block v4.0
Completely rewritten to ensure collection paths show properly
{% endcomment %}

<div class="shopify-app-block-breadcrumbs" 
     style="width:100%;
           background-color:{{ block.settings.background_color | default: '#f6f6f6' }};
           padding:10px 0;
           margin-bottom:20px;
           font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;">
  <div style="max-width:1200px;
             margin:0 auto;
             padding:0 15px;
             display:flex;
             flex-wrap:wrap;
             align-items:center;">
    <!-- Home Link -->
    <a href="/" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">Home</a>

    {% case template %}
      {% when 'product' %}
        <!-- Product Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        
        {% comment %}Collection link - first try current collection context{% endcomment %}
        {% if collection %}
          <a href="{{ collection.url }}" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">
            {{ collection.title }}
          </a>
        {% comment %}If no collection context, try to get one from product{% endcomment %}
        {% elsif product.collections.size > 0 %}
          {% for collection in product.collections limit: 1 %}
            {% if collection.handle != 'all' %}
              <a href="{{ collection.url }}" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">
                {{ collection.title }}
              </a>
            {% endif %}
          {% endfor %}
        {% endif %}
        
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ product.title }}
        </span>
        
      {% when 'collection' %}
        <!-- Collection Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ collection.title }}
        </span>
        
      {% when 'page' %}
        <!-- Page Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ page.title }}
        </span>
        
      {% when 'blog' %}
        <!-- Blog Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ blog.title }}
        </span>
        
      {% when 'article' %}
        <!-- Article Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <a href="{{ blog.url }}" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">
          {{ blog.title }}
        </a>
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ article.title }}
        </span>
        
      {% when 'cart' %}
        <!-- Cart Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          Shopping Cart
        </span>
        
      {% when 'search' %}
        <!-- Search Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          Search Results
        </span>
        
      {% else %}
        <!-- Default Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ page_title }}
        </span>
    {% endcase %}
  </div>
</div>

{% schema %}
{
  "name": "Smart Breadcrumbs",
  "target": "section",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f6f6f6"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link Color",
      "default": "#0066cc"
    }
  ]
}
{% endschema %} 