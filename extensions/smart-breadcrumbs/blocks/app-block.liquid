{% comment %}
Smart Breadcrumbs App Block v5.0.0
100% Liquid implementation with JavaScript error prevention
{% endcomment %}

<script src="{{ 'breadcrumbs-override.js' | asset_url }}" defer></script>

{% if template != 'index' and template != 'cart' and template != 'list-collections' and template != '404' %}
  <div class="shopify-app-block-breadcrumbs" 
      style="width:100%;
            background-color:{{ block.settings.background_color | default: '#f6f6f6' }};
            padding:10px 0;
            margin-bottom:20px;
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;">
    <div style="max-width:1200px;
              margin:0 auto;
              padding:0 15px;
              display:flex;
              flex-wrap:wrap;
              align-items:center;">
      <!-- Home Link -->
      <a href="/" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">Home</a>

      {% assign template_type = template | split: '.' | first %}
      
      {% if template_type == 'product' %}
        <!-- Product Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        
        {% comment %}Collection link - first try current collection context{% endcomment %}
        {% if collection %}
          <a href="{{ collection.url }}" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">
            {{ collection.title }}
          </a>
        {% comment %}If no collection context, try to get one from product{% endcomment %}
        {% elsif product.collections.size > 0 %}
          {% assign primary_collection = false %}
          {% for collection in product.collections %}
            {% if collection.handle != 'all' and primary_collection == false %}
              {% assign primary_collection = collection %}
            {% endif %}
          {% endfor %}
          
          {% if primary_collection %}
            <a href="{{ primary_collection.url }}" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">
              {{ primary_collection.title }}
            </a>
          {% endif %}
        {% endif %}
        
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ product.title }}
        </span>
        
      {% elsif template_type == 'collection' %}
        <!-- Collection Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ collection.title }}
        </span>
        
      {% elsif template_type == 'page' %}
        <!-- Page Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ page.title }}
        </span>
        
      {% elsif template_type == 'blog' %}
        <!-- Blog Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ blog.title }}
        </span>
        
      {% elsif template_type == 'article' %}
        <!-- Article Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <a href="{{ blog.url }}" style="color:{{ block.settings.link_color | default: '#0066cc' }};text-decoration:none;font-size:14px;">
          {{ blog.title }}
        </a>
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ article.title }}
        </span>
      
      {% else %}
        <!-- Default Breadcrumb -->
        <span style="margin:0 8px;color:#999;font-size:14px;">/</span>
        <span style="color:{{ block.settings.text_color | default: '#333333' }};font-size:14px;font-weight:500;">
          {{ page_title }}
        </span>
      {% endif %}
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Smart Breadcrumbs",
  "target": "section",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f6f6f6"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link Color",
      "default": "#0066cc"
    }
  ]
}
{% endschema %} 